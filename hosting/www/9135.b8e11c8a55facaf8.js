"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9135],{9135:(C,f,s)=>{s.r(f),s.d(f,{Admintab1PageModule:()=>x});var p=s(9808),b=s(4182),d=s(4153),h=s(1115),B=s(4850),P=s(5439),y=s(5867),r=s(6435),D=s(5920),v=s(2316),S=s(520);function O(i,c){if(1&i&&(r.TgZ(0,"ion-item",1)(1,"ion-avatar",2),r._UZ(2,"img",3),r.qZA(),r.TgZ(3,"ion-label")(4,"h2",4),r._uU(5),r.qZA(),r.TgZ(6,"p"),r._uU(7),r.qZA()()()),2&i){const e=c.$implicit;r.MGl("routerLink","/orderdetails/",e.id,"/orders"),r.xp6(5),r.AsE("",e.BillingFirstname," ",e.BillingLastname,""),r.xp6(2),r.Oqu(e.Datetime)}}const T=[{path:"",component:(()=>{class i{constructor(e,n,a,u,m,g){this.afstore=e,this.afauth=n,this.router=a,this.currencyPipe=u,this.alertCtrl=m,this.http=g,this.allPendingOrders=[],this.currentStock=[],this.page=0,this.users=[],this.afauth.authState.subscribe(t=>{t&&t.uid&&(this.productReference=this.afstore.collection("Orders",l=>l.where("Status","==","Open")),this.sub=this.productReference.snapshotChanges().pipe((0,B.U)(l=>l.map(o=>Object.assign({id:o.payload.doc.id},o.payload.doc.data())))).subscribe(l=>{console.log("orders",l),l=(l=l.map((o,A)=>Object.assign({BillingAddress1:o.BillingAddress1,BillingAddress2:o.BillingAddress2,BillingFirstname:o.BillingFirstname,BillingIndexId:o.BillingIndexId,BillingLastname:o.BillingLastname,BillingPhonenumber:o.BillingPhonenumber,Billingemail:o.Billingemail,Datetime:o.Datetime,Status:o.Status,TotalAmount:o.TotalAmount,id:o.id,DatetimeToSort:o.DatetimeToSort,OrderDetails:o.OrderDetails}))).sort((o,A)=>Number(A.DatetimeToSort)-Number(o.DatetimeToSort)),this.allPendingOrders=l}))})}ngOnInit(){}addproduct(){this.alertCtrl.create({header:"Choose",inputs:[{type:"radio",label:"POS",value:"POS"},{type:"radio",label:"View Products",value:"View Products"},{type:"radio",label:"Add Product",value:"Add Product"}],buttons:[{text:"Go",handler:e=>{console.log("data",e),"View Products"==e?this.router.navigateByUrl("/viewproducts"):"Add Product"==e?this.router.navigateByUrl("/add-product"):"POS"==e&&this.router.navigateByUrl("/createpos")}},{text:"Cancel",role:"cancel"}]}).then(e=>{e.present()})}closeAccordion(){this.accordionGroup.value=""}toggleSection(){this.accordionGroup.value="frameworks"}approveOrder(e){this.currentProductStockReference=this.afstore.collection("Products"),this.sub2=this.currentProductStockReference.snapshotChanges().pipe((0,B.U)(n=>n.map(a=>Object.assign({id:a.payload.doc.id},a.payload.doc.data())))).subscribe(n=>{var m,u=(m=n,e.OrderDetails.map(t=>Object.assign({},Object.assign({},t,{Stock:m.find(l=>l.id===t.id&&l).Stock,Category:t.Category,ImageUrl:t.ImageUrl,ProductName:t.ProductName,Quantity:t.Quantity,UnitPrice:t.UnitPrice,id:t.id}))));this.currentStock=u}),this.alertCtrl.create({header:"Question",message:"Are you sure you want to approve this order?",buttons:[{text:"Yes",handler:()=>{var n=this.currentStock.filter(t=>t.Quantity>t.Stock);if(n.length>0)alert(`Insufficient Stock: \n  ${n.map(function(t){return`${t.ProductName} > ${t.Stock} current stock \n`}).join("\n")}`);else{var a=P(new Date).format("DD-MM-YYYY hh:mm A");this.afstore.doc(`Orders/${e.id}`).update({Status:"Closed"});var u=this.currencyPipe.transform(e.TotalAmount,"",""),g=`Your order has been confirmed by the admin. ${e.OrderDetails.map(function(t){return`${t.ProductName}(${t.Quantity} pcs), Unit price of \u20b1${t.UnitPrice}`}).join(", ")}. Total amount of \u20b1${u}`;this.afstore.collection(`users/${e.BillingIndexId}/notifications`).add({Message:g,Datetime:a,read:!1,remarks:"Your order has been confirmed",DatetimeToSort:new Date}),e.OrderDetails.forEach(t=>{this.afstore.doc(`Products/${t.id}`).update({Stock:y.Z.firestore.FieldValue.increment(-t.Quantity)})}),e.OrderDetails.forEach(t=>{this.afstore.collection("Inventory").add({Quantity:-1*parseInt(t.Quantity),Datetime:a,read:!1,Destination:e.BillingFirstname+" "+e.BillingLastname,ProductName:t.ProductName,UnitPrice:t.UnitPrice,ImageUrl:t.ImageUrl,DatetimeToSort:new Date})}),this.afstore.collection("History").add({BillingAddress1:e.BillingAddress1,BillingAddress2:e.BillingAddress2,BillingFirstname:e.BillingFirstname,BillingIndexId:e.BillingIndexId,BillingLastname:e.BillingLastname,BillingPhonenumber:e.BillingPhonenumber,Billingemail:e.Billingemail,Datetime:e.Datetime,Status:"Closed",TotalAmount:e.TotalAmount,id:e.id,OrderDetails:e.OrderDetails,read:!1,DatetimeToSort:new Date}),this.alertCtrl.create({header:"Success",message:"This order approved successfully",buttons:[{text:"Ok",role:"cancel"}]}).then(t=>{t.present()})}}},{text:"No",role:"cancel"}]}).then(n=>{n.present()})}cancelOrder(e){this.alertCtrl.create({header:"Confirmation",message:"Are you sure you want to cancel this order?",buttons:[{text:"Yes",handler:()=>{this.alertCtrl.create({header:"Remarks",message:"Please add a remarks why you want to cancel this order",inputs:[{name:"remarks",placeholder:"Add a remarks"}],buttons:[{text:"Submit remarks",handler:n=>{var a=P(new Date).format("DD-MM-YYYY hh:mm A");this.afstore.doc(`Orders/${e.id}`).update({Status:"Cancelled"});var u=this.currencyPipe.transform(e.TotalAmount,"",""),g=`Your order has been declined by the admin. ${e.OrderDetails.map(function(t){return`${t.ProductName}(${t.Quantity} pcs), Unit price of \u20b1${t.UnitPrice}`}).join(", ")}. Total amount of \u20b1${u}`;this.afstore.collection(`users/${e.BillingIndexId}/notifications`).add({Message:g,Datetime:a,read:!1,remarks:n.remarks,DatetimeToSort:new Date}),this.afstore.collection("History").add({BillingAddress1:e.BillingAddress1,BillingAddress2:e.BillingAddress2,BillingFirstname:e.BillingFirstname,BillingIndexId:e.BillingIndexId,BillingLastname:e.BillingLastname,BillingPhonenumber:e.BillingPhonenumber,Billingemail:e.Billingemail,Datetime:e.Datetime,Status:"Cancelled",TotalAmount:e.TotalAmount,id:e.id,OrderDetails:e.OrderDetails,DatetimeToSort:new Date}),this.alertCtrl.create({header:"Success",message:"This order cancelled successfully",buttons:[{text:"Ok",role:"cancel"}]}).then(t=>{t.present()})}}]}).then(n=>{n.present()})}},{text:"No",role:"cancel"}]}).then(n=>{n.present()})}}return i.\u0275fac=function(e){return new(e||i)(r.Y36(D.ST),r.Y36(v.zQ),r.Y36(h.F0),r.Y36(p.H9),r.Y36(d.Br),r.Y36(S.eN))},i.\u0275cmp=r.Xpm({type:i,selectors:[["app-admintab1"]],viewQuery:function(e,n){if(1&e&&r.Gf(d.eh,5),2&e){let a;r.iGM(a=r.CRH())&&(n.accordionGroup=a.first)}},decls:3,vars:1,consts:[["button","","lines","none",3,"routerLink",4,"ngFor","ngForOf"],["button","","lines","none",3,"routerLink"],["slot","start"],["src","https://thumbs.dreamstime.com/b/person-icon-flat-design-template-isolated-avatar-sign-vector-illustration-symbol-205838177.jpg"],["text-capitalize",""]],template:function(e,n){1&e&&(r.TgZ(0,"ion-content")(1,"ion-card"),r.YNc(2,O,8,4,"ion-item",0),r.qZA()()),2&e&&(r.xp6(2),r.Q6J("ngForOf",n.allPendingOrders))},dependencies:[p.sg,d.BJ,d.PM,d.W2,d.Ie,d.Q$,d.YI,h.rH]}),i})()}];let I=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[h.Bz.forChild(T),h.Bz]}),i})(),x=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[p.ez,b.u5,d.Pc,I]}),i})()}}]);