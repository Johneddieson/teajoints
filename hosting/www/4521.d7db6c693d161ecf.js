"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4521],{4521:(B,p,c)=>{c.r(p),c.d(p,{AdmincheckoutPageModule:()=>v});var d=c(9808),O=c(4182),a=c(4153),m=c(1115),I=c(5439),k=c(4850),D=c(5867),t=c(6435),S=c(2316),y=c(5920),M=c(1423);function x(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-thumbnail",1),t._UZ(2,"img",7),t.qZA(),t.TgZ(3,"ion-label")(4,"h2"),t._uU(5),t.TgZ(6,"span",8),t._uU(7),t.ALo(8,"currency"),t.qZA()(),t._UZ(9,"h3"),t.TgZ(10,"p",9),t._uU(11),t.qZA(),t.TgZ(12,"div",10),t._UZ(13,"span",11),t._uU(14),t._UZ(15,"span",12),t.TgZ(16,"span",13)(17,"button",14),t.NdJ("click",function(){const u=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.singleDelete(u))}),t._uU(18," Remove"),t.qZA()()()()()}if(2&i){const e=l.$implicit;t.xp6(2),t.s9C("src",e.ImageUrl,t.LSH),t.xp6(3),t.hij("",e.ProductName," "),t.xp6(2),t.Oqu(t.xi3(8,5,e.UnitPrice,"\u20b1")),t.xp6(4),t.hij(" ",e.Stock," remaining stock"),t.xp6(3),t.hij(" ",e.Quantity," ")}}function b(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-button",15),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.OrderNow())}),t._uU(1,"Confirm Order"),t.qZA()}}const A=[{path:"",component:(()=>{class i{constructor(e,o,n,u,r,f){this.alertCtrl=e,this.locationStrategy=o,this.router=n,this.afauth=u,this.afstore=r,this.msg=f,this.getCartDetails=[],this.getCurrentProductDetails=[],this.total=0,this.cartItem=0,this.getOrders=[],this.myInformation={},this.afauth.authState.subscribe(h=>{h&&h.uid&&(this.stockRefence=this.afstore.collection("Products"),this.stockRefence.snapshotChanges().pipe((0,k.U)(s=>s.map(C=>Object.assign({id:C.payload.doc.id},C.payload.doc.data())))).subscribe(s=>{this.getCartDetails=JSON.parse(sessionStorage.getItem("cart"));var _=((Z,U)=>this.getCartDetails.map(g=>Object.assign({},Object.assign({},g,{Stock:U.find(P=>P.id===g.id&&P).Stock,Category:g.Category,ImageUrl:g.ImageUrl,ProductName:g.ProductName,Quantity:g.Quantity,UnitPrice:g.UnitPrice,id:g.id}))))(0,s);sessionStorage.removeItem("cart"),this.getCartDetails=sessionStorage.setItem("cart",JSON.stringify(_)),this.CartDetails()}),this.meReference=r.doc(`users/${h.uid}`),this.sub=this.meReference.valueChanges().subscribe(s=>{this.myInformation=s}))})}ngOnInit(){this.CartDetails(),this.loadCart()}CartDetails(){sessionStorage.getItem("cart")&&(this.getCartDetails=JSON.parse(sessionStorage.getItem("cart")))}inc(e,o){for(let n=0;n<this.getCartDetails.length;n++)this.getCartDetails[n].id===e&&(this.getCartDetails[n].Quantity=o+1);sessionStorage.setItem("cart",JSON.stringify(this.getCartDetails)),this.loadCart()}dec(e,o){for(let n=0;n<this.getCartDetails.length;n++)this.getCartDetails[n].id===e&&1!=o&&(this.getCartDetails[n].Quantity=o-1);sessionStorage.setItem("cart",JSON.stringify(this.getCartDetails)),this.loadCart()}loadCart(){sessionStorage.getItem("cart")&&(this.getCartDetails=JSON.parse(sessionStorage.getItem("cart")),this.total=this.getCartDetails.reduce((e,o)=>e+o.UnitPrice*o.Quantity,0))}removeall(){sessionStorage.removeItem("cart"),this.getCartDetails=[],this.total=0,this.cartItem=0,this.msg.cartSubject.next(this.cartItem),this.loadCart()}singleDelete(e){if(sessionStorage.getItem("cart")){this.getCartDetails=JSON.parse(sessionStorage.getItem("cart"));for(let o=0;o<this.getCartDetails.length;o++)this.getCartDetails[o].id===e.id&&(this.getCartDetails.splice(o,1),sessionStorage.setItem("cart",JSON.stringify(this.getCartDetails)),this.loadCart(),this.cartItemFunc())}}cartItemFunc(){var e=JSON.parse(sessionStorage.getItem("cart"));this.cartItem=e.length,this.msg.cartSubject.next(this.cartItem)}gotohome(){this.router.navigate(["tabs"])}OrderNow(){this.CartDetails();var e=this.getCartDetails.filter(n=>n.Quantity>n.Stock);if(e.length>0)alert(`Insufficient Stock: \n  ${e.map(function(n){return`${n.ProductName} > ${n.Stock} current stock \n`}).join("\n")}`);else{this.CartDetails();var o=this.getCartDetails.filter(n=>n.Quantity>n.Stock);if(o.length>0)alert(`Insufficient Stock: \n  ${o.map(function(n){return n.ProductName}).join("\n")}`);else{let n=this.getCartDetails.length>1?"orders":"order",u="";this.alertCtrl.create({message:"Are you sure you want to approve this order?",buttons:[{text:"Ok",handler:()=>{this.alertCtrl.create({header:"Customer Name",inputs:[{name:"Name",placeholder:"Customer Name",type:"text"}],buttons:[{text:"Ok",handler:r=>{r.Name&&null!=r.Name?r.Name.length<4?alert("Name of customer should be four characters minimum"):this.alertCtrl.create({message:`${r.Name} ${n} has been approved!`,buttons:[{text:"Ok",role:"cancel"}]}).then(f=>{f.present();var h=I(new Date).format("DD-MM-YYYY hh:mm A");this.afstore.collection("Orders").add({OrderDetails:this.getCartDetails,BillingFirstname:r.Name,BillingLastname:"Walk-In",BillingAddress1:"Walk-In",BillingAddress2:"Walk-In",BillingPhonenumber:"Walk-In",Billingemail:"Walk-In",BillingIndexId:"",Status:"Approved",Datetime:h,TotalAmount:parseFloat(this.total.toString()).toFixed(2),DatetimeToSort:new Date}).then(s=>{u=s.id}).catch(s=>{}),this.getCartDetails.forEach(s=>{this.afstore.doc(`Products/${s.id}`).update({Stock:D.Z.firestore.FieldValue.increment(-s.Quantity)})}),this.getCartDetails.forEach(s=>{this.afstore.collection("Inventory").add({Quantity:-1*parseInt(s.Quantity),Datetime:h,read:!1,Destination:r.Name,ProductName:s.ProductName,UnitPrice:s.UnitPrice,ImageUrl:s.ImageUrl,DatetimeToSort:new Date})}),this.afstore.collection("History").add({BillingAddress1:"Walk-In",BillingAddress2:"Walk-In",BillingFirstname:r.Name,BillingIndexId:"",BillingLastname:"Walk-In",BillingPhonenumber:"Walk-In",Billingemail:"Walk-In",Datetime:h,Status:"Closed",TotalAmount:parseFloat(this.total.toString()).toFixed(2),id:u,OrderDetails:this.getCartDetails,read:!1,DatetimeToSort:new Date}),this.removeall()}):alert("Name of customer is required")}},{text:"Cancel",handler:r=>{}}]}).then(r=>{r.present()})}},{text:"Cancel",role:"cancel"}]}).then(r=>{r.present()})}}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(a.Br),t.Y36(d.S$),t.Y36(m.F0),t.Y36(S.zQ),t.Y36(y.ST),t.Y36(M.g))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-admincheckout"]],decls:23,vars:6,consts:[["color","primary"],["slot","start"],[1,"container"],[4,"ngFor","ngForOf"],["size","7"],["size","5"],["color","light",3,"click",4,"ngIf"],[3,"src"],[2,"float","right","color","#3880ff"],[1,"rate"],["id","qty"],[1,"minus"],[1,"plus"],[2,"float","right"],["id","btn",3,"click"],["color","light",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-buttons",1),t._UZ(4,"ion-back-button"),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6,"Check Out"),t.qZA()()(),t.TgZ(7,"ion-content")(8,"div",2)(9,"ion-grid")(10,"ion-row")(11,"ion-col")(12,"ion-list"),t.YNc(13,x,19,8,"ion-item",3),t.qZA()()()()()(),t.TgZ(14,"ion-footer")(15,"ion-row")(16,"ion-col",4)(17,"ion-text")(18,"h4"),t._uU(19),t.ALo(20,"currency"),t.qZA()()(),t.TgZ(21,"ion-col",5),t.YNc(22,b,2,0,"ion-button",6),t.qZA()()()),2&e&&(t.xp6(13),t.Q6J("ngForOf",o.getCartDetails),t.xp6(6),t.hij("Total : ",t.xi3(20,3,o.total,"\u20b1")," "),t.xp6(3),t.Q6J("ngIf",o.total>0))},dependencies:[d.sg,d.O5,a.oU,a.YG,a.Sm,a.wI,a.W2,a.fr,a.jY,a.Gu,a.Ie,a.Q$,a.q_,a.Nd,a.yW,a.Bs,a.wd,a.sr,a.cs,d.H9],styles:[".toolbar[_ngcontent-%COMP%]{height:84px;--background: #69A03A;color:#fff;font-size:20px;line-height:84px}.buttonsactive[_ngcontent-%COMP%]:active{background-color:red;font-weight:500}.container[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{width:100px!important;height:100px!important}.container[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:10px}.container[_ngcontent-%COMP%]   .rate[_ngcontent-%COMP%]{color:#ccc}.container[_ngcontent-%COMP%]   #qty[_ngcontent-%COMP%]{margin-top:5px}.container[_ngcontent-%COMP%]   #qty[_ngcontent-%COMP%]   .minus[_ngcontent-%COMP%]{font-weight:600;padding:5px;margin-right:20px;cursor:pointer}.container[_ngcontent-%COMP%]   #qty[_ngcontent-%COMP%]   .plus[_ngcontent-%COMP%]{margin-left:20px;font-weight:600;padding:5px;cursor:pointer}.container[_ngcontent-%COMP%]   #qty[_ngcontent-%COMP%]   #btn[_ngcontent-%COMP%]{padding:10px 20px;color:#fff;background-color:red}.container[_ngcontent-%COMP%]   #qty[_ngcontent-%COMP%]   #btn[_ngcontent-%COMP%]:active{background-color:#051542}.container[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:10px;color:#69a03a}ion-footer[_ngcontent-%COMP%]{--background: #3880ff}ion-footer[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{background:#3880ff;color:#fff}ion-footer[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]:last-child{text-align:end}ion-back-button[_ngcontent-%COMP%]{display:block}"]}),i})()}];let N=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[m.Bz.forChild(A),m.Bz]}),i})(),v=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[d.ez,O.u5,a.Pc,N]}),i})()}}]);