"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4521],{4521:(B,C,s)=>{s.r(C),s.d(C,{AdmincheckoutPageModule:()=>v});var h=s(9808),O=s(4182),c=s(4153),m=s(1115),x=s(5439),y=s(4850),S=s(5867),t=s(6435),I=s(2316),A=s(5920),D=s(1423);function k(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"div",5),t._UZ(3,"img",6),t.TgZ(4,"div")(5,"p"),t._uU(6),t._UZ(7,"br"),t.TgZ(8,"small"),t._uU(9),t.ALo(10,"currency"),t.qZA(),t._UZ(11,"br"),t.TgZ(12,"a",7),t.NdJ("click",function(){const d=t.CHM(e).$implicit,o=t.oxw();return t.KtG(o.singleDelete(d))}),t._uU(13,"Remove"),t.qZA()()()()(),t.TgZ(14,"td"),t._UZ(15,"input",8),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.ALo(18,"currency"),t.qZA()()}if(2&n){const e=l.$implicit;t.xp6(3),t.s9C("src",e.ImageUrl,t.LSH),t.xp6(3),t.hij("",e.ProductName," "),t.xp6(3),t.hij("Price: ",t.xi3(10,5,e.UnitPrice,"\u20b1"),""),t.xp6(6),t.s9C("value",e.Quantity),t.xp6(2),t.Oqu(t.xi3(18,8,e.Quantity*e.UnitPrice,"\u20b1"))}}function M(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",11),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.OrderNow())}),t._uU(1,"Confirm Order"),t.qZA()}}function Z(n,l){if(1&n&&(t.TgZ(0,"div",9)(1,"table")(2,"tr")(3,"td"),t._uU(4,"Subtotal"),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"currency"),t.qZA()(),t.TgZ(8,"tr")(9,"td"),t._uU(10,"Shipping Fee"),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.ALo(13,"currency"),t.qZA()(),t.TgZ(14,"tr")(15,"td"),t._uU(16,"Total Amount"),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.ALo(19,"currency"),t.qZA()(),t.TgZ(20,"tr"),t._UZ(21,"td"),t.TgZ(22,"td"),t.YNc(23,M,2,0,"ion-button",10),t.qZA()()()()),2&n){const e=t.oxw();t.xp6(6),t.Oqu(t.xi3(7,4,e.total,"\u20b1")),t.xp6(6),t.Oqu(t.xi3(13,7,0,"\u20b1")),t.xp6(6),t.Oqu(t.xi3(19,10,e.total,"\u20b1")),t.xp6(5),t.Q6J("ngIf",e.total>0)}}const _=[{path:"",component:(()=>{class n{constructor(e,a,i,d,o,p){this.alertCtrl=e,this.locationStrategy=a,this.router=i,this.afauth=d,this.afstore=o,this.msg=p,this.getCartDetails=[],this.getCurrentProductDetails=[],this.total=0,this.cartItem=0,this.getOrders=[],this.myInformation={},this.afauth.authState.subscribe(u=>{u&&u.uid&&(this.stockRefence=this.afstore.collection("Products"),this.stockRefence.snapshotChanges().pipe((0,y.U)(r=>r.map(f=>Object.assign({id:f.payload.doc.id},f.payload.doc.data())))).subscribe(r=>{this.getCartDetails=JSON.parse(sessionStorage.getItem("cart"));var U=((N,T)=>this.getCartDetails.map(g=>Object.assign({},Object.assign({},g,{Stock:T.find(P=>P.id===g.id&&P).Stock,Category:g.Category,ImageUrl:g.ImageUrl,ProductName:g.ProductName,Quantity:g.Quantity,UnitPrice:g.UnitPrice,id:g.id}))))(0,r);sessionStorage.removeItem("cart"),this.getCartDetails=sessionStorage.setItem("cart",JSON.stringify(U)),this.CartDetails()}),this.meReference=o.doc(`users/${u.uid}`),this.sub=this.meReference.valueChanges().subscribe(r=>{this.myInformation=r}))})}ngOnInit(){this.CartDetails(),this.loadCart()}CartDetails(){sessionStorage.getItem("cart")&&(this.getCartDetails=JSON.parse(sessionStorage.getItem("cart")))}inc(e,a){for(let i=0;i<this.getCartDetails.length;i++)this.getCartDetails[i].id===e&&(this.getCartDetails[i].Quantity=a+1);sessionStorage.setItem("cart",JSON.stringify(this.getCartDetails)),this.loadCart()}dec(e,a){for(let i=0;i<this.getCartDetails.length;i++)this.getCartDetails[i].id===e&&1!=a&&(this.getCartDetails[i].Quantity=a-1);sessionStorage.setItem("cart",JSON.stringify(this.getCartDetails)),this.loadCart()}loadCart(){sessionStorage.getItem("cart")&&(this.getCartDetails=JSON.parse(sessionStorage.getItem("cart")),this.total=this.getCartDetails.reduce((e,a)=>e+a.UnitPrice*a.Quantity,0))}removeall(){sessionStorage.removeItem("cart"),this.getCartDetails=[],this.total=0,this.cartItem=0,this.msg.cartSubject.next(this.cartItem),this.loadCart()}singleDelete(e){if(sessionStorage.getItem("cart")){this.getCartDetails=JSON.parse(sessionStorage.getItem("cart"));for(let a=0;a<this.getCartDetails.length;a++)this.getCartDetails[a].id===e.id&&(this.getCartDetails.splice(a,1),sessionStorage.setItem("cart",JSON.stringify(this.getCartDetails)),this.loadCart(),this.cartItemFunc())}}cartItemFunc(){var e=JSON.parse(sessionStorage.getItem("cart"));this.cartItem=e.length,this.msg.cartSubject.next(this.cartItem)}gotohome(){this.router.navigate(["tabs"])}OrderNow(){this.CartDetails();var e=this.getCartDetails.filter(i=>i.Quantity>i.Stock);if(e.length>0)alert(`Insufficient Stock: \n  ${e.map(function(i){return`${i.ProductName} > ${i.Stock} current stock \n`}).join("\n")}`);else{this.CartDetails();var a=this.getCartDetails.filter(i=>i.Quantity>i.Stock);if(a.length>0)alert(`Insufficient Stock: \n  ${a.map(function(i){return i.ProductName}).join("\n")}`);else{let i=this.getCartDetails.length>1?"orders":"order",d="";this.alertCtrl.create({message:"Are you sure you want to approve this order?",buttons:[{text:"Ok",handler:()=>{this.alertCtrl.create({header:"Customer Name",inputs:[{name:"Name",placeholder:"Customer Name",type:"text"}],buttons:[{text:"Ok",handler:o=>{o.Name&&null!=o.Name?o.Name.length<4?alert("Name of customer should be four characters minimum"):this.alertCtrl.create({message:`${o.Name} ${i} has been approved!`,buttons:[{text:"Ok",role:"cancel"}]}).then(p=>{p.present();var u=x(new Date).format("DD-MM-YYYY hh:mm A");this.afstore.collection("Orders").add({OrderDetails:this.getCartDetails,BillingFirstname:o.Name,BillingLastname:"Walk-In",BillingAddress1:"Walk-In",BillingAddress2:"Walk-In",BillingPhonenumber:"Walk-In",Billingemail:"Walk-In",BillingIndexId:"",Status:"Approved",Datetime:u,TotalAmount:parseFloat(this.total.toString()).toFixed(2),DatetimeToSort:new Date}).then(r=>{d=r.id}).catch(r=>{}),this.getCartDetails.forEach(r=>{this.afstore.doc(`Products/${r.id}`).update({Stock:S.Z.firestore.FieldValue.increment(-r.Quantity)})}),this.getCartDetails.forEach(r=>{this.afstore.collection("Inventory").add({Quantity:-1*parseInt(r.Quantity),Datetime:u,read:!1,Destination:o.Name,ProductName:r.ProductName,UnitPrice:r.UnitPrice,ImageUrl:r.ImageUrl,DatetimeToSort:new Date})}),this.afstore.collection("History").add({BillingAddress1:"Walk-In",BillingAddress2:"Walk-In",BillingFirstname:o.Name,BillingIndexId:"",BillingLastname:"Walk-In",BillingPhonenumber:"Walk-In",Billingemail:"Walk-In",Datetime:u,Status:"Closed",TotalAmount:parseFloat(this.total.toString()).toFixed(2),id:d,OrderDetails:this.getCartDetails,read:!1,DatetimeToSort:new Date}),this.removeall()}):alert("Name of customer is required")}},{text:"Cancel",handler:o=>{}}]}).then(o=>{o.present()})}},{text:"Cancel",role:"cancel"}]}).then(o=>{o.present()})}}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(c.Br),t.Y36(h.S$),t.Y36(m.F0),t.Y36(I.zQ),t.Y36(A.ST),t.Y36(D.g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-admincheckout"]],decls:18,vars:2,consts:[["color","light"],["slot","start"],[1,"small-container","cart-page"],[4,"ngFor","ngForOf"],["class","total-price",4,"ngIf"],[1,"cart-info"],[3,"src"],[3,"click"],["type","text","disabled","",3,"value"],[1,"total-price"],["color","light",3,"click",4,"ngIf"],["color","light",3,"click"]],template:function(e,a){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),t._UZ(3,"ion-back-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"Check Out"),t.qZA()()(),t.TgZ(6,"ion-content")(7,"div",2)(8,"table")(9,"tr")(10,"th"),t._uU(11,"Product"),t.qZA(),t.TgZ(12,"th"),t._uU(13,"Quantity"),t.qZA(),t.TgZ(14,"th"),t._uU(15,"Subtotal"),t.qZA()(),t.YNc(16,k,19,11,"tr",3),t.qZA(),t.YNc(17,Z,24,13,"div",4),t.qZA()()),2&e&&(t.xp6(16),t.Q6J("ngForOf",a.getCartDetails),t.xp6(1),t.Q6J("ngIf",a.total>0))},dependencies:[h.sg,h.O5,c.oU,c.YG,c.Sm,c.W2,c.Gu,c.wd,c.sr,c.cs,h.H9],styles:["ion-back-button[_ngcontent-%COMP%]{display:block}ion-content[_ngcontent-%COMP%]   .cart-page[_ngcontent-%COMP%]{margin:16px auto;border:12vmax}ion-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}ion-content[_ngcontent-%COMP%]   .cart-info[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}ion-content[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:5px;color:#fff;background:#ff523b;font-weight:400}ion-content[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 5px}ion-content[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:40px;height:30px;padding:5px}ion-content[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#ff523b;font-size:14px;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;cursor:pointer}ion-content[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   small[_ngcontent-%COMP%], ion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}ion-content[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80px;height:80px;margin-right:10px}ion-content[_ngcontent-%COMP%]   .total-price[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}ion-content[_ngcontent-%COMP%]   .total-price[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{border-top:3px solid #ff523b;width:100%;max-width:370px}ion-content[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{text-align:right}ion-content[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child{text-align:right}"]}),n})()}];let b=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[m.Bz.forChild(_),m.Bz]}),n})(),v=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[h.ez,O.u5,c.Pc,b]}),n})()}}]);